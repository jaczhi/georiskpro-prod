"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[3667],{13667:(e,r,n)=>{n.r(r),n.d(r,{createLabelFunction:()=>x,formatField:()=>d});var t=n(70375),a=n(13802),l=n(72057),s=n(25741),u=n(17095),i=n(1110),o=n(30879);const c=a.Z.getLogger("esri.layers.support.labelFormatUtils"),p={type:"simple",evaluate:()=>null},f={getAttribute:(e,r)=>e.field(r)};async function x(e,r,a){if(!e||!e.symbol||!r)return p;const l=e.where,s=(0,i.hV)(e),u=l?await Promise.resolve().then(n.bind(n,3362)):null;let x;if("arcade"===s.type){const e=await(0,o.WW)(s.expression,a,r);if(null==e)return p;x={type:"arcade",evaluate(r){try{const n=e.evaluate({$feature:"attributes"in r?e.repurposeFeature(r):r},e.services);if(null!=n)return n.toString()}catch(e){c.error(new t.Z("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:e,feature:r,expression:s}))}return null},needsHydrationToEvaluate:()=>null==(0,i.el)(s.expression)}}else x={type:"simple",evaluate:e=>s.expression.replaceAll(/{[^}]*}/g,(n=>{const t=n.slice(1,-1),a=r.get(t);if(!a)return n;let l=null;return"attributes"in e?e&&e.attributes&&(l=e.attributes[a.name]):l=e.field(a.name),null==l?"":d(l,a)}))};if(l){let e;try{e=u.WhereClause.create(l,r)}catch(e){return c.error(new t.Z("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:l,error:e})),p}const n=x.evaluate;x.evaluate=r=>{const a="attributes"in r?void 0:f;try{if(e.testFeature(r,a))return n(r)}catch(e){c.error(new t.Z("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:l,feature:r,error:e}))}return null}}return x}function d(e,r){if(null==e)return"";const n=r.domain;if(n)if("codedValue"===n.type||"coded-value"===n.type){const r=e;for(const e of n.codedValues)if(e.code===r)return e.name}else if("range"===n.type){const r=+e,t="range"in n?n.range[0]:n.minValue,a="range"in n?n.range[1]:n.maxValue;if(t<=r&&r<=a)return n.name}let t=e;return"date"===r.type||"esriFieldTypeDate"===r.type?t=(0,l.p6)(t,(0,l.Ze)("short-date")):(0,u.H7)(r)&&(t=(0,s.uf)(+t)),t||""}},1110:(e,r,n)=>{n.d(r,{UO:()=>w,YI:()=>g,dI:()=>b,el:()=>E,hV:()=>d,z7:()=>x});var t=n(21130);const a="__begin__",l="__end__",s=new RegExp(a,"ig"),u=new RegExp(l,"ig"),i=new RegExp("^"+a,"i"),o=new RegExp(l+"$","i"),c='"',p=c+" + ",f=" + "+c;function x(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function d(e){const r={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(r.expression=e.labelExpressionInfo.value,r.type="conventional"):e.labelExpressionInfo.expression&&(r.expression=e.labelExpressionInfo.expression,r.type="arcade"):null!=e.labelExpression&&(r.expression=function(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}(e.labelExpression),r.type="conventional"),r}function g(e){const r=d(e);if(!r)return null;switch(r.type){case"conventional":return b(r.expression);case"arcade":return r.expression}return null}function w(e){const r=d(e);if(!r)return null;switch(r.type){case"conventional":return function(e){const r=e?.match(h);return r&&r[1].trim()||null}(r.expression);case"arcade":return E(r.expression)}return null}function b(e){let r;return e?(r=(0,t.gx)(e,(e=>a+'$feature["'+e+'"]'+l)),r=i.test(r)?r.replace(i,""):c+r,r=o.test(r)?r.replace(o,""):r+c,r=r.replaceAll(s,p).replaceAll(u,f)):r='""',r}const h=/^\s*\{([^}]+)\}\s*$/i,y=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,v=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,m=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function E(e){if(!e)return null;let r=y.exec(e)||v.exec(e);return r?r[1]||r[3]:(r=m.exec(e),r?r[2]:null)}}}]);